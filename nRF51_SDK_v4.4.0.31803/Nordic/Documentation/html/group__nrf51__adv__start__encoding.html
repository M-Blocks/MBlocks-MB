<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>0x63 - sd_ble_gap_adv_start</title>
<link href="tabs.css" rel="stylesheet" type="text/css" />
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="alias.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="alias.js"></script>
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/javascript">
  jQuery(document).ready(function () {
    if(gref){ // Number all _img and _table classes
      gref();
    }
  });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nordic_small.png"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51 SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__nrf51__adv__start__encoding.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">0x63 - sd_ble_gap_adv_start<div class="ingroups"><a class="el" href="group__nrf51__encoding__functions__serialization.html">BLE S110 Functions</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="nrf51_adv_start_encoding_sec"></a>
Function packet format</h1>
<p>Frame format encoding of the <a class="el" href="group___b_l_e___g_a_p___f_u_n_c_t_i_o_n_s.html#gab18b2339fa4c752037d9c9cd4df4e551">sd_ble_gap_adv_start</a> packet.</p>
<p>Operation Code = 0x63 (99) for sd_ble_gap_adv_start, see <a class="el" href="group___b_l_e___g_a_p___e_n_u_m_e_r_a_t_i_o_n_s.html#gae39030093ebca17966d1896533d1b556">BLE_GAP_SVCS</a>.</p>
<p>The parameter provided as input to sd_ble_gap_adv_start is encoded in the following order: </p>
<table  border="0">
<tr>
<td>- 1 byte: </td><td></td><td>Operation Code, Value = 0x63 (99) </td></tr>
<tr>
<td>- 8 ... 201 bytes: </td><td><a class="el" href="structble__gap__adv__params__t.html">ble_gap_adv_params_t</a>  </td><td>GAP Advertising Parameters (See Figure 1 for details on encoding) </td></tr>
</table>
<p><br/>
 As can also be seen in <b>Figure 1</b> some fields in the encoded data are optional, i.e. <a class="el" href="structble__gap__adv__params__t.html#a27909d1b865548f236a871af2b6aa584">ble_gap_adv_params_t::p_peer_addr</a> and <a class="el" href="structble__gap__adv__params__t.html#adb87fb082d472fabc44d42aeaa67a842">ble_gap_adv_params_t::p_whitelist</a> . <br/>
</p>
<p>The encoded field 'Peer Address Present' identifies if a NULL pointer was provided in <a class="el" href="structble__gap__adv__params__t.html#a27909d1b865548f236a871af2b6aa584">ble_gap_adv_params_t::p_peer_addr</a>. If a NULL pointer was provided, the value of 'Peer Address Present' will be set to '0x00' and no data will be encoded. Otherwise it will be set to '0x01, and the encoding of the Peer Address field will follow immediately, as seen in Figure 2.<br/>
</p>
<p>The encoded field 'GAP Whitelist Present' identifies if a NULL pointer was provided in <a class="el" href="structble__gap__adv__params__t.html#adb87fb082d472fabc44d42aeaa67a842">ble_gap_adv_params_t::p_whitelist</a>. If a NULL pointer was provided, the value of 'GAP Whitelist Present' will be set to '0x00', and no data will be encoded. Otherwise it will be set to '0x01, and the encoding of the GAP Whitelist structure will follow immediately, as seen in Figure 3.<br/>
</p>
<p>The data inside ble_gap_adv_start_params_t are encoded as: </p>
<table  border="0">
<tr>
<td>- 1 byte:</td><td></td><td>GAP Advertising Type </td></tr>
<tr>
<td>- 1 byte:</td><td></td><td>Peer Address Present </td></tr>
<tr>
<td></td><td></td><td>0x00 Field not present </td></tr>
<tr>
<td></td><td></td><td>0x01 Field present and follows immediately in the packet </td></tr>
<tr>
<td>- 7 bytes:</td><td><a class="el" href="structble__gap__adv__params__t.html#a27909d1b865548f236a871af2b6aa584">ble_gap_adv_params_t::p_peer_addr</a> </td><td><b>Conditional:</b> Peer Address </td></tr>
<tr>
<td></td><td></td><td>Encoding details can be seen in Figure 2 </td></tr>
<tr>
<td>- 1 byte:</td><td><a class="el" href="group___b_l_e___g_a_p___a_d_v___f_i_l_t_e_r___p_o_l_i_c_i_e_s.html">GAP Advertising filter policies</a>  </td><td>Filter Policy </td></tr>
<tr>
<td>- 1 byte:</td><td></td><td>GAP Whitelist Present </td></tr>
<tr>
<td></td><td></td><td>0x00 Field not present </td></tr>
<tr>
<td></td><td></td><td>0x01 Field present and follows immediately in the packet </td></tr>
<tr>
<td>- 2 ... 186 bytes:</td><td><a class="el" href="structble__gap__adv__params__t.html#adb87fb082d472fabc44d42aeaa67a842">ble_gap_adv_params_t::p_whitelist</a>  </td><td><b>Conditional:</b> GAP Whitelist </td></tr>
<tr>
<td></td><td></td><td>Encoding details can be seen in Figure 3 </td></tr>
</table>
<p><br/>
</p>
<div class="image">
<img src="advertising_start_packet.png" alt="advertising_start_packet.png"/>
<div class="caption">
Figure 1: Packet format for sd_ble_gap_adv_start function.</div></div>
<h2><a class="anchor" id="nrf51_adv_start_encoding_sub_a"></a>
Encoding of Peer Address</h2>
<p>If 'Peer Address Present' = 0x01, then the encoding of the 'Peer Address' will follow. 'Peer Address' is a <a class="el" href="structble__gap__addr__t.html">ble_gap_addr_t</a> .</p>
<p>The data inside <a class="el" href="structble__gap__addr__t.html" title="Bluetooth Low Energy address.">ble_gap_addr_t</a> are encoded as: </p>
<table  border="0">
<tr>
<td>- 1 byte:</td><td></td><td>Address type, see <a class="el" href="group___b_l_e___g_a_p___a_d_d_r___t_y_p_e_s.html">GAP Address types</a>  </td></tr>
<tr>
<td>- 6 bytes:</td><td></td><td>Address </td></tr>
</table>
<p>If 'Peer Address Present' = 0x00, the encoding of 'Filter Policy' will follow, and hence no 'Peer Address' will be encoded in the packet.</p>
<div class="image">
<img src="advertising_start_address_packet.png" alt="advertising_start_address_packet.png"/>
<div class="caption">
Figure 2: Encoding of peer address if present.</div></div>
<h2><a class="anchor" id="nrf51_adv_start_encoding_sub_b"></a>
Encoding of GAP Whitelist</h2>
<p>If 'GAP Whitelist Present' = 0x01, then the encoding of the 'GAP Whitelist' will follow. <br/>
 'GAP Whitelist' is a <a class="el" href="structble__gap__whitelist__t.html" title="White list structure.">ble_gap_whitelist_t</a> .<br/>
</p>
<p><a class="el" href="structble__gap__whitelist__t.html" title="White list structure.">ble_gap_whitelist_t</a> contains two counters, <a class="el" href="structble__gap__whitelist__t.html#aca75fb744e3dc086e102ec1fdac4c977">ble_gap_whitelist_t::addr_count</a> and <a class="el" href="structble__gap__whitelist__t.html#a108b2b32b411b5dec5c7ae4d1d895a54">ble_gap_whitelist_t::irk_count</a>, as well as two pointers to arrays. One pointer <a class="el" href="structble__gap__whitelist__t.html#a5acf7d1b34810f682c6db841e002bca9">ble_gap_whitelist_t::pp_addrs</a> pointing to an array of whitelist addresses, and a pointer <a class="el" href="structble__gap__whitelist__t.html#ab8237904f2dec4cdd9c441afb2374aff">ble_gap_whitelist_t::pp_irks</a> pointing to an array of IRKs.</p>
<p>The encoded 'GAP whitelist' will first contain the address counter, followed by the encoding of each address. Then the IRK counter, followed by the encoding of each IRK.</p>
<p>The data inside <a class="el" href="structble__gap__whitelist__t.html" title="White list structure.">ble_gap_whitelist_t</a> are encoded as: </p>
<table  border="0">
<tr>
<td>- 1 byte:</td><td></td><td>Address Counter  </td></tr>
<tr>
<td>- 0 ... 56 bytes:</td><td></td><td>Address list  </td></tr>
<tr>
<td></td><td></td><td>'Address Counter' specifies the actual number of addresses encoded. </td></tr>
<tr>
<td>- 1 byte:</td><td></td><td>IRK Counter  </td></tr>
<tr>
<td>- 0 ... 128 bytes:</td><td></td><td>IRK list  </td></tr>
<tr>
<td></td><td></td><td>'IRK Counter' specifies the actual number of IRKs encoded. </td></tr>
</table>
<p>If 'GAP Whitelist Present' = 0x00, the encoding of 'Interval' will follow, and hence no 'GAP Whitelist' will be encoded in the packet.</p>
<div class="image">
<img src="advertising_start_whitelist_packet.png" alt="advertising_start_whitelist_packet.png"/>
<div class="caption">
Figure 3: Encoding of GAP Whitelist if present.</div></div>
<h2><a class="anchor" id="nrf51_adv_start_encoding_sub_c"></a>
Encoding of GAP Whitelist Addresses Array</h2>
<p>The encoding of whitelist addresses start with the 'Whitelist Count' according to the value in <a class="el" href="structble__gap__whitelist__t.html#aca75fb744e3dc086e102ec1fdac4c977">ble_gap_whitelist_t::addr_count</a>. <br/>
 If, the value of 'Whitelist Count' is 0, then no whitelist addresses are encoded, and the 'Whitelist Count' will be followed by the 'IRK Count' as seen in the top of Figure 4.<br/>
</p>
<p>Otherwise each whitelist address, <a class="el" href="structble__gap__addr__t.html">ble_gap_addr_t</a> , will be encoded as specified by the counter. Each address is 7 bytes, with first byte specifying the address type.</p>
<p>The Whitelist addresses are encoded as: </p>
<table  border="0">
<tr>
<td>- 1 byte:</td><td></td><td>Whitelist Address Count </td></tr>
</table>
<p>For each address, as defined by 'Whitelist Address Count', the following data are encoded: </p>
<table  border="0">
<tr>
<td>- 1 byte:</td><td></td><td>Address Type, see <a class="el" href="group___b_l_e___g_a_p___a_d_d_r___t_y_p_e_s.html">GAP Address types</a>  </td></tr>
<tr>
<td>- 6 bytes:</td><td></td><td>Address </td></tr>
</table>
<div class="image">
<img src="advertising_start_whitelist_addr_full_packet.png" alt="advertising_start_whitelist_addr_full_packet.png"/>
<div class="caption">
Figure 4: Encoding of Whitelist Addresses.</div></div>
 <h2><a class="anchor" id="nrf51_adv_start_encoding_sub_d"></a>
Encoding of GAP Whitelist IRKs Array</h2>
<p>The encoding of whitelist IRKs start with the 'IRK Count' according to the value in <a class="el" href="structble__gap__whitelist__t.html#a108b2b32b411b5dec5c7ae4d1d895a54">ble_gap_whitelist_t::irk_count</a>. <br/>
 If, the value of 'IRK Count' is 0, then no IRKs are encoded, and the 'IRK Count' will be followed by the 'Interval' field as seen in the top of Figure 5.<br/>
</p>
<p>Otherwise each IRK, <a class="el" href="structble__gap__irk__t.html">ble_gap_irk_t</a> , will be encoded as specified by the counter. Each IRK is 16 bytes.</p>
<p>The IRKs are encoded as: </p>
<table  border="0">
<tr>
<td>- 1 byte:</td><td></td><td>IRK Count </td></tr>
</table>
<p>For each IRK, as defined by 'IRK Count', the following data are encoded: </p>
<table  border="0">
<tr>
<td>- 16 bytes:</td><td></td><td>IRK </td></tr>
</table>
<div class="image">
<img src="advertising_start_whitelist_irk_packet.png" alt="advertising_start_whitelist_irk_packet.png"/>
<div class="caption">
Figure 5: Encoding of Whitelist IRKs.</div></div>
 <h1><a class="anchor" id="nrf51_adv_start_encoding_sec_response"></a>
Response packet format</h1>
<p>Frame format encoding of the <a class="el" href="group___b_l_e___g_a_p___f_u_n_c_t_i_o_n_s.html#gab18b2339fa4c752037d9c9cd4df4e551">sd_ble_gap_adv_start</a> response packet.</p>
<p>In case of an error, the following data is encoded:</p>
<table  border="0">
<tr>
<td>- 1 byte:</td><td width="140"></td><td>Operation Code, Value = 0x63 (99) </td></tr>
<tr>
<td>- 4 byte:</td><td width="140"></td><td>nRF Error Code </td></tr>
</table>
<p><br/>
</p>
<div class="image">
<img src="default_error_response_packet.png" alt="default_error_response_packet.png"/>
<div class="caption">
Figure 2: Packet format for sd_ble_gap_adv_start error response.</div></div>
<p>In case of a successful command, i.e. <code>'nRF Error Code' = <a class="el" href="group__foftt__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a></code>, the following data is encoded:</p>
<table  border="0">
<tr>
<td>- 1 byte: </td><td width="140"></td><td>Operation Code, Value = 0x63 (99) </td></tr>
<tr>
<td>- 4 bytes:</td><td width="140"></td><td>nRF Error Code </td></tr>
</table>
<p><br/>
</p>
<div class="image">
<img src="default_success_response_packet.png" alt="default_success_response_packet.png"/>
<div class="caption">
Figure 3: Packet format for sd_ble_gap_adv_start success response.</div></div>
 </div><!-- contents -->
</div><!-- doc-content -->

    <li class="footer">
      Copyright &copy 2006-2013 <a href="http://www.nordicsemi.no" style="text-decoration:none">Nordic Semiconductor</a>.
      All Rights Reserved.
      <a href="disclaimer.html">Disclaimer</a>
    </li>
   </ul>
 </div>
</body>
</html>
