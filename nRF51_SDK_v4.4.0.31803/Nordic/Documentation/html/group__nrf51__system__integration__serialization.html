<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>&#39;HCI- Transport Layer - System integration&#39;</title>
<link href="tabs.css" rel="stylesheet" type="text/css" />
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="alias.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="alias.js"></script>
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/javascript">
  jQuery(document).ready(function () {
    if(gref){ // Number all _img and _table classes
      gref();
    }
  });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nordic_small.png"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51 SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__nrf51__system__integration__serialization.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">'HCI- Transport Layer - System integration'<div class="ingroups"><a class="el" href="group__nrf51__architechture__serialization.html">'Architecture'</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>System integration overview of BLE S110 SoftDevice serialization.  
<a href="#details">More...</a></p>
<h1><a class="anchor" id="nrf51_sys_integration_serialization"></a>
BLE S110 SoftDevice Serialization: System Integration</h1>
<p>The image below shows the internal architecture of a serialized BLE S110 SoftDevice. </p>
<div class="image">
<img src="connectivity_chip_architecture_serialization.png" alt="connectivity_chip_architecture_serialization.png"/>
<div class="caption">
Internal architecture of a serialized BLE S110 SoftDevice.</div></div>
<p> The image below shows the various threads of execution within the serialized BLE S110 Connectivity Chip. </p>
<div class="image">
<img src="connectivity_chip_priority_contexts_serialization.png" alt="connectivity_chip_priority_contexts_serialization.png"/>
<div class="caption">
Various threads of execution within the serialized BLE S110 Connectivity Chip.</div></div>
<ol type="1">
<li>SoftDevice command decode and event encode context: MAIN priority context<br/>
 1.1 SoftDevice command API call as an output of command decode: MAIN priority context</li>
<li>UART TX/RX ISR calls: APP-LO priority context</li>
<li>hci_transport retransmission timeout context: APP-LO priority context</li>
<li>SoftDevice events: MAIN priority context</li>
</ol>
<p>The image below shows an example internal architecture of an application chip controlling the serialized BLE S110 SoftDevice. </p>
<div class="image">
<img src="application_chip_architecture_serialization.png" alt="application_chip_architecture_serialization.png"/>
<div class="caption">
An example of internal architecture of an application chip.</div></div>
<p> The image below shows an example of various threads of execution which could be executing within an application chip controlling the serialized BLE S110 SoftDevice. </p>
<div class="image">
<img src="application_chip_priority_contexts_serialization.png" alt="application_chip_priority_contexts_serialization.png"/>
<div class="caption">
An example of various threads of execution within the application chip.</div></div>
<ol type="1">
<li>SoftDevice calls: MAIN priority context</li>
<li>UART TX/RX ISR calls: APP-LO priority context</li>
<li>hci_transport retransmission timeout context: APP-LO priority context</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>The current application chip reference design has been validated using the priority context setup as defined in the above figure. Any deviation from this model can lead to undefined behavior.</dd></dl>
<p>The image below shows an MSC of a single basic TX path cycle. </p>
<div class="image">
<img src="tx_path_cycle_serialization.png" alt="tx_path_cycle_serialization.png"/>
<div class="caption">
Basic TX path cycle.</div></div>
<ol type="1">
<li>TX codec allocates TX packet memory and issues a packet write request. Request is processed throughout the stack and asynchronous packet write to the UART hardware is started. TX codec receives the status of the request via return code (NRF_SUCCESS), which informs it that a packet was added to the transmission queue and an event will be send upon transmission completion.</li>
<li>TX buffer is eventually transferred completely and a corresponding event gets propagated to hci_transport which will omit propagating it to TX codec until a valid ACK for the TX packet is received.</li>
<li>Valid ACK for TX packet is received, which will complete the TX cycle and is reported to the TX codec.</li>
<li>TX codec received the information of a completed TX cycle and can free the corresponding TX buffer or reuse it for future TX requests.</li>
</ol>
<p>The image below shows an MSC of a TX path cycle where TX path is 1st stopped due TX queue been filled up and after correct event reception resumed. </p>
<div class="image">
<img src="tx_path_queue_full_cycle_serialization.png" alt="tx_path_queue_full_cycle_serialization.png"/>
<div class="caption">
TX path queue full cycle.</div></div>
<ol type="1">
<li>TX codec allocates TX packet memory and issues a packet write request. Request is processed throughout the stack and asynchronous packet write to the UART hardware is started. TX codec receives the status of the request via return code (NRF_SUCCESS), which informs it that a packet was added to the transmission queue and an event will be send upon transmission completion.</li>
<li>TX codec allocates new TX packet memory and issues a new packet write request while the previous request is still in progress. This request will fail (NRF_ERROR_NO_MEM) because the transmission queue is full and the packet was not added. Before issuing this operation again the appropriate event needs to occur.</li>
<li>Valid ACK for the TX packet is received. This completes the TX cycle and is reported to the TX codec which can re-issue the packet write request.</li>
</ol>
<p>The image below shows an MSC of a single basic RX path cycle. </p>
<div class="image">
<img src="rx_path_cycle_serialization.png" alt="rx_path_cycle_serialization.png"/>
<div class="caption">
Basic RX path cycle.</div></div>
<ol type="1">
<li>Free RX memory block is produced by hci_transport and given to hci_slip layer to be used as an RX buffer. RX data is received through the UART, which will be decoded by the hci_slip layer and an event is send to hci_transport layer once a valid slip packet has been received.</li>
<li>Valid RX packet is decoded by hci_transport layer and corresponding ACK packet is written to TX queue (if available space exists otherwise it is discarded). Actual length of the received RX packet is stored to the corresponding RX memory block. New free RX memory block is produced by hci_transport and given to hci_slip layer to be used as RX buffer.</li>
<li>An event is send to the RX codec when a valid RX packet is received. The received packet is extracted and processed by the RX codec allowing the memory to be reused by the hci_transport layer. </li>
</ol>
</div><!-- contents -->
</div><!-- doc-content -->

    <li class="footer">
      Copyright &copy 2006-2013 <a href="http://www.nordicsemi.no" style="text-decoration:none">Nordic Semiconductor</a>.
      All Rights Reserved.
      <a href="disclaimer.html">Disclaimer</a>
    </li>
   </ul>
 </div>
</body>
</html>
