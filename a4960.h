/*
 * a4960.h
 *
 *  Created on: Nov 26, 2013
 *      Author: Kyle Gilpin
 */

#ifndef A4960_H_
#define A4960_H_

#include <stdint.h>
#include <stdbool.h>


#define A4960_CONFIG0_REG_ADDR	0x00
#define A4960_CONFIG1_REG_ADDR	0x01
#define A4960_CONFIG2_REG_ADDR	0x02
#define A4960_CONFIG3_REG_ADDR	0x03
#define A4960_CONFIG4_REG_ADDR	0x04
#define A4960_CONFIG5_REG_ADDR	0x05
#define A4960_MASK_REG_ADDR		0x06
#define A4960_RUN_REG_ADDR		0x07


/* Configuration register 0 fields */
#define A4960_DEADTIME_POSN			0
#define A4960_DEADTIME_MASK			(0x3F << A4960_DEADTIME_POSN)
#define A4960_BLANKTIME_POSN		6
#define A4960_BLANKTIME_MASK		(0x0F << A4960_BLANKTIME_POSN)
#define A4960_COMMBLANKTIME_POSN	10
#define A4960_COMMBLANKTIME_MASK	(0x03 << A4960_COMMBLANKTIME_POSN)

/* Configuration register 1 fields */
#define A4960_VDSTHRESHOLD_POSN		0
#define A4960_VDSTHRESHOLD_MASK		(0x3F << A4960_VDSTHRESHOLD_POSN)
#define A4960_REFERENCERATIO_POSN	6
#define A4960_REFERENCERATIO_MASK	(0x0F << A4960_REFERENCERATIO_POSN)

/* Configuration register 2 fields */
#define	A4960_PWMOFFTIME_POSN		0
#define	A4960_PWMOFFTIME_MASK		(0x1F << A4960_PWMOFFTIME_POSN)

/* Configuration register 3 fields */
#define A4960_HOLDTIME_POSN			0
#define A4960_HOLDTIME_MASK			(0x0F << A4960_HOLDTIME_POSN)
#define A4960_HOLDTORQUE_POSN		4
#define A4960_HOLDTORQUE_MASK		(0x0F << A4960_HOLDTORQUE_POSN)
#define A4960_TORQUECONTROL_POSN	8
#define A4960_TORQUECONTROL_MASK	(0x01 << A4960_TORQUECONTROL_POSN)

/* Configuration register 4 fields */
#define A4960_STARTCOMM_POSN		0
#define A4960_STARTCOMM_MASK		(0x0F << A4960_STARTCOMM_POSN)
#define A4960_ENDCOMM_POSN			4
#define A4960_ENDCOMM_MASK			(0x0F << A4960_ENDCOMM_POSN)

/* Configuration register 5 fields */
#define A4960_RAMPRATE_POSN			0
#define A4960_RAMPRATE_MASK			(0x0F << A4960_RAMPRATE_POSN)
#define A4960_RAMPTORQUE_POSN		4
#define A4960_RAMPTORQUE_MASK		(0x0F << A4960_RAMPTORQUE_POWN)
#define A4960_PHASEADV_POSN			8
#define A4960_PHASEADV_MASK			(0x0F << A4960_PHASEADV_POSN)

/* Run register fields */
#define A4960_RUN_POSN				0
#define A4960_RUN_MASK				(0x01 << A4960_RUN_POSN)
#define A4960_DIRECTION_POSN		1
#define A4960_DIRECTION_MASK		(0x01 << A4960_DIRECTION_POSN)
#define A4960_BRAKE_POSN			2
#define A4960_BRAKE_MASK			(0x01 << A4960_BRAKE_POSN)
#define A4960_RESTART_POSN			3
#define A4960_RESTART_MASK			(0x01 << A4960_RESTART_POSN)
#define A4960_DIAGSIGNAL_POSN		4
#define A4960_DIAGSIGNAL_MASK		(0x03 << A4960_DIAGSIGNAL_POSN)
#define A4960_ENABLESTOPFAIL_POSN	6
#define A4960_ENABLESTOPFAIL_MASK	(0x01 << A4960_ENABLESTOPFAIL_POSN)
#define A4960_BEMFWINDOW_POSN		7
#define A4960_BEMFWINDOW_MASK		(0x07 << A4960_BEMFWINDOW_POSN)
#define A4960_BEMFHYSTERESIS_POSN	10
#define A4960_BEMFHYSTERESIS_MASK	(0x03 << A4960_BEMFHYSTERESIS_POSN)

/* Mask and diagnostic register fields */
#define A4960_PHASECLOW_POSN		0
#define A4960_PHASECLOW_MASK		(0x01 << A4960_PHASECLOW_POSN)
#define A4960_PHASECHIGH_POSN		1
#define A4960_PHASECHIGH_MASK		(0x01 << A4960_PHASECHIGH_POSN)
#define A4960_PHASEBLOW_POSN		2
#define A4960_PHASEBLOW_MASK		(0x01 << A4960_PHASEBLOW_POSN)
#define A4960_PHASEBHIGH_POSN		3
#define A4960_PHASEBHIGH_MASK		(0x01 << A4960_PHASEBHIGH_POSN)
#define A4960_PHASEALOW_POSN		4
#define A4960_PHASEALOW_MASK		(0x01 << A4960_PHASEALOW_POSN)
#define A4960_PHASEAHIGH_POSN		5
#define A4960_PHASEAHIGH_MASK		(0x01 << A4960_PHASEAHIGH_POSN)
#define A4960_PHASECBOOTCAP_POSN	6
#define A4960_PHASECBOOTCAP_MASK	(0x01 << A4960_PHASECBOOTCAP_POSN)
#define A4960_PHASEBBOOTCAP_POSN	7
#define A4960_PHASEBBOOTCAP_MASK	(0x01 << A4960_PHASEBBOOTCAP_POSN)
#define A4960_PHASEABOOTCAP_POSN	8
#define A4960_PHASEABOOTCAP_MASK	(0x01 << A4960_PHASEABOOTCAP_POSN)
#define A4960_BEMFLOST_POSN			9
#define A4960_BEMFLOST_MASK			(0x01 << A4960_BEMFLOST_POSN)
#define A4960_OVERTEMP_POSN			10
#define A4960_OVERTEMP_MASK			(0x01 << A4960_OVERTEMP_POSN)
#define A4960_HIGHTEMP_POSN			11
#define A4960_HIGHTEMP_MASK			(0x01 << A4960_HIGHTEMP_POSN)

/* Diagnostic register only fields */
#define A4960_UNDERVOLTAGE_POSN		13
#define A4960_UNDERVOLTAGE_MASK		(0x01 << A4960_UNDERVOLTAGE_POSN)
#define A4960_POR_POSN				14
#define A4960_POR_MASK				(0x01 << A4960_POR_POSN)
#define A4960_GENFAULT_POSN			15
#define A4960_GENFAULT_MASK			(0x01 << A4960_GENFAULT_POSN)


bool a4960_writeReg(uint8_t addr, uint16_t data, uint16_t *diag);
bool a4960_readReg(uint8_t addr, uint16_t *data);
bool a4960_readDiag(uint16_t *diag);

#endif /* A4960_H_ */
